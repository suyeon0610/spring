<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.mvc.board.repository.IBoardMapper">

	<resultMap type="com.spring.mvc.board.model.BoardVO"
		id="BoardMap">
		<id property="boardNo" column="board_no" />
		<result property="regDate" column="reg_date" />
		<result property="viewCnt" column="view_cnt" />
	</resultMap>

	<insert id="insert">
		INSERT INTO mvc_board
		(board_no, title, content,
		writer)
		VALUES(board_seq.NEXTVAL, #{title}, #{content}, #{writer})
	</insert>

	<!-- 
		쿼리문을 작성할 때 '<', '>', '&' 등의 기호를 사용해야 하는 경우,
		xml파일에서 이를 그냥 사용할 경우 태그로 인식하는 경우가 있음
		이럴 경우 해당 기호가 태그문법이 아닌 실제 쿼리에 필요한 코드라고 인식시켜야 함.
		이 때 사용해야 할 문법: <!CDATA[...쿼리...]]>
		CADATA안에 쿼리 작성 시 쿼리 내용의 괄호나 특수문자를 xml문법으로 인식하지 않고
		문자열로 인식
	 -->

	<select id="getArticleList" resultMap="BoardMap">
		SELECT *
		FROM
		(
			SELECT ROWNUM as rn, tbl.*
			FROM
			(
				SELECT * FROM mvc_board
				<if test="condition == title">WHERE title Like %||#{keyword}||%</if>
				<if test="condition == writer">WHERE title Like %||#{keyword}||%</if>
				<if test="condition == content">WHERE title Like %||#{keyword}||%</if>
				<if test="condition == titleContent">WHERE title Like %||#{keyword}||% OR content LIKE %||#{keyword}||%</if>
				ORDER BY board_no DESC
			) tbl
		)
		<![CDATA[
			WHERE rn > ((#{paging.page}-1) * #{paging.countPerPage})
			AND rn <= (#{paging.page} * #{paging.countPerPage})
		]]>
	</select>

	<select id="getArticle" resultMap="BoardMap">
		SELECT * FROM mvc_board
		WHERE
		board_no=#{boardNo}
	</select>

	<update id="update">
		UPDATE mvc_board
		SET title=#{title},
		CONTENT=#{content}
		WHERE board_no = #{boardNo}
	</update>

	<delete id="delete">
		DELETE FROM mvc_board
		WHERE board_no = #{boardNo}
	</delete>

	<select id="countArticles" resultType="int">
		SELECT COUNT(*) FROM
		mvc_board
	</select>


</mapper>